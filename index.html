<script>

/* ================= TROCA DE ABAS ================= */
function showTab(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

/* ================= BANCO DE ALIMENTOS COMPLETO ================= */
/* valores por 100g */
const alimentos={
"Arroz":{cal:130,p:2.5,c:28,g:0.3},
"FeijÃ£o":{cal:77,p:5,c:14,g:0.5},
"Frango":{cal:165,p:31,c:0,g:3.6},
"Carne":{cal:250,p:26,c:0,g:15},
"Ovo":{cal:155,p:13,c:1,g:11},
"MacarrÃ£o":{cal:158,p:6,c:30,g:1},
"Banana":{cal:89,p:1,c:23,g:0.3},
"MaÃ§Ã£":{cal:52,p:0.3,c:14,g:0.2},
"Leite":{cal:42,p:3.4,c:5,g:1},
"Queijo":{cal:402,p:25,c:1,g:33},
"Aveia":{cal:389,p:17,c:66,g:7},
"Batata":{cal:86,p:2,c:20,g:0.1},
"Peixe":{cal:206,p:22,c:0,g:12},
"PÃ£o":{cal:265,p:9,c:49,g:3},
"Iogurte":{cal:59,p:10,c:3,g:0.4},
"Chocolate":{cal:546,p:5,c:61,g:31},
"Pizza":{cal:266,p:11,c:33,g:10}
};

const select=document.getElementById("alimento");
for(let a in alimentos){
let o=document.createElement("option");
o.text=a;
select.add(o);
}

/* ================= REFEIÃ‡Ã•ES ================= */
let refeicoes=JSON.parse(localStorage.getItem("refeicoes")||"[]");

function salvarRefeicoes(){localStorage.setItem("refeicoes",JSON.stringify(refeicoes));}

function addComida(){
let comida=select.value;
let qtd=parseFloat(quantidade.value);
if(!qtd) return;

let base=alimentos[comida];
let item={
comida,
qtd,
cal:(base.cal*qtd)/100,
p:(base.p*qtd)/100,
c:(base.c*qtd)/100,
g:(base.g*qtd)/100
};

refeicoes.push(item);
salvarRefeicoes();
renderRefeicoes();
}

function renderRefeicoes(){
listaComidas.innerHTML="";
let total={cal:0,p:0,c:0,g:0};

refeicoes.forEach((r,i)=>{
total.cal+=r.cal;
total.p+=r.p;
total.c+=r.c;
total.g+=r.g;

listaComidas.innerHTML+=`
<li>
${r.comida} ${r.qtd}g  
ğŸ”¥${r.cal.toFixed(1)}kcal  
ğŸ¥©${r.p.toFixed(1)}P  
ğŸ${r.c.toFixed(1)}C  
ğŸ¥‘${r.g.toFixed(1)}G
<button class='edit' onclick='editarComida(${i})'>Editar</button>
<button class='delete' onclick='delComida(${i})'>X</button>
</li>`;
});

totalRefeicao.innerHTML=
`ğŸ”¥ ${total.cal.toFixed(1)} kcal |
ğŸ¥© ${total.p.toFixed(1)}g |
ğŸ ${total.c.toFixed(1)}g |
ğŸ¥‘ ${total.g.toFixed(1)}g`;
}

function delComida(i){refeicoes.splice(i,1);salvarRefeicoes();renderRefeicoes();}

function editarComida(i){
let nova=prompt("Nova quantidade (g):",refeicoes[i].qtd);
if(!nova) return;
let base=alimentos[refeicoes[i].comida];
refeicoes[i].qtd=nova;
refeicoes[i].cal=(base.cal*nova)/100;
refeicoes[i].p=(base.p*nova)/100;
refeicoes[i].c=(base.c*nova)/100;
refeicoes[i].g=(base.g*nova)/100;
salvarRefeicoes();
renderRefeicoes();
}
renderRefeicoes();

/* ================= DIETA AUTOMÃTICA ================= */
function gerarDieta(){
let p=pesoIMC.value,a=alturaIMC.value;
let imc=p/(a*a);
let base=imc<18.5?2500:imc<25?2000:1600;

let prot=p*2;
let gord=(base*0.25)/9;
let carb=(base-(prot*4+gord*9))/4;

dietaResultado.innerHTML=`
IMC: ${imc.toFixed(1)}<br>
Calorias: ${base} kcal<br>
ProteÃ­na: ${prot.toFixed(0)}g<br>
Carboidratos: ${carb.toFixed(0)}g<br>
Gorduras: ${gord.toFixed(0)}g`;
}

/* ================= TREINO ================= */
let treino=JSON.parse(localStorage.getItem("treino")||[
"Seg: Pernas",
"Ter: Peito",
"Qua: Costas",
"Qui: Ombro",
"Sex: BraÃ§os"
]);

function gerarTreino(){
localStorage.setItem("treino",JSON.stringify(treino));
renderTreino();
}
function renderTreino(){
listaTreino.innerHTML="";
treino.forEach((t,i)=>{
listaTreino.innerHTML+=`<li>${t}
<button class='edit' onclick='editarTreino(${i})'>Editar</button>
<button class='delete' onclick='delTreino(${i})'>X</button></li>`;
});
}
function editarTreino(i){
let n=prompt("Editar treino:",treino[i]);
if(!n)return;
treino[i]=n;
localStorage.setItem("treino",JSON.stringify(treino));
renderTreino();
}
function delTreino(i){
treino.splice(i,1);
localStorage.setItem("treino",JSON.stringify(treino));
renderTreino();
}
renderTreino();

/* ================= PLANO SEMANAL ================= */
let plano=JSON.parse(localStorage.getItem("plano")||[]);
function addPlano(){
plano.push({dia:diaSemana.value,desc:refSemana.value});
localStorage.setItem("plano",JSON.stringify(plano));
renderPlano();
}
function renderPlano(){
listaPlano.innerHTML="";
plano.forEach((p,i)=>{
listaPlano.innerHTML+=`<li>${p.dia} - ${p.desc}
<button class='edit' onclick='editarPlano(${i})'>Editar</button>
<button class='delete' onclick='delPlano(${i})'>X</button></li>`;
});
}
function editarPlano(i){
let n=prompt("Editar:",plano[i].desc);
plano[i].desc=n;
localStorage.setItem("plano",JSON.stringify(plano));
renderPlano();
}
function delPlano(i){
plano.splice(i,1);
localStorage.setItem("plano",JSON.stringify(plano));
renderPlano();
}
renderPlano();

/* ================= GRÃFICO PESO ================= */
let pesos=JSON.parse(localStorage.getItem("pesos")||[]);
function salvarPeso(){
pesos.push(novoPeso.value);
localStorage.setItem("pesos",JSON.stringify(pesos));
grafico.update();
}
const grafico=new Chart(graficoPeso,{
type:'line',
data:{labels:pesos.map((_,i)=>i+1),datasets:[{label:'Peso',data:pesos}]}
});

/* ================= LEMBRETES ================= */
let intervalo;
function iniciarLembrete(){
Notification.requestPermission().then(()=>{
clearInterval(intervalo);
intervalo=setInterval(()=>new Notification("Hora do lembrete!"),minutos.value*60000);
});
}

</script>
